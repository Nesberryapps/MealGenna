#!/usr/bin/env sh

#
# Copyright 2015 the original author or authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

#
# @author...
#

# Add default JVM options here. You can also use JAVA_OPTS and GRADLE_OPTS to pass any JVM options to Gradle.
DEFAULT_JVM_OPTS=""

APP_NAME="Gradle"
APP_BASE_NAME=`basename "$0"`

# Use the maximum available path length for the script path.
# This avoids issues with path length restrictions on Windows.
if [ -L "$0" ] ; then
  PRG_SCRIPT_PATH=`readlink -f "$0"`
else
  PRG_SCRIPT_PATH="$0"
fi
# The directory containing the script.
PRG_DIR=`dirname "$PRG_SCRIPT_PATH"`

# Read relative path to script from .dist dir.
if [ -f "$PRG_DIR/.dist/${APP_BASE_NAME}.path" ] ; then
  APP_HOME_REL_PATH=`cat "$PRG_DIR/.dist/${APP_BASE_NAME}.path"`
  APP_HOME=`(cd "$PRG_DIR" && cd "$APP_HOME_REL_PATH" && pwd)`
else
  # No contents in .dist dir. Just use the script's directory.
  APP_HOME="$PRG_DIR"
fi
export APP_HOME

# For Cygwin, ensure paths are in UNIX format before anything is touched.
if ${cygwin} ; then
  [ -n "$JAVA_HOME" ] && JAVA_HOME=`cygpath --unix "$JAVA_HOME"`
  [ -n "$GRADLE_HOME" ] && GRADLE_HOME=`cygpath --unix "$GRADLE_HOME"`
fi

# Attempt to set APP_HOME
if [ -z "$APP_HOME" ] || ! [ -d "$APP_HOME" ] ; then
  # Fallback to resolving the location of the gradlew script.
  PRG="$0"
  # need this for relative symlinks
  while [ -h "$PRG" ] ; do
    ls=`ls -ld "$PRG"`
    link=`expr "$ls" : '.*-> \(.*\)$'`
    if expr "$link" : '/.*' > /dev/null; then
      PRG="$link"
    else
      PRG=`dirname "$PRG"`"/$link"
    fi
  done
  APP_HOME=`dirname "$PRG"`/..
fi
# Make sure APP_HOME is absolute.
APP_HOME=`cd "$APP_HOME" && pwd`

# Add the gradle wrapper jar to the classpath.
GRADLE_WRAPPER_JAR="$APP_HOME/gradle/wrapper/gradle-wrapper.jar"
CLASSPATH=$GRADLE_WRAPPER_JAR

# Set the GRADLE_USER_HOME directory.
if [ -z "$GRADLE_USER_HOME" ] ; then
    GRADLE_USER_HOME="$HOME/.gradle"
fi
export GRADLE_USER_HOME

# For Cygwin, switch paths to Windows format before running java
if ${cygwin} ; then
  APP_HOME=`cygpath --path --windows "$APP_HOME"`
  CLASSPATH=`cygpath --path --windows "$CLASSPATH"`
  GRADLE_USER_HOME=`cygpath --path --windows "$GRADLE_USER_HOME"`
fi

# Determine the Java command to use to start the JVM.
if [ -n "$JAVA_HOME" ] ; then
    if [ -x "$JAVA_HOME/jre/sh/java" ] ; then
        # IBM's JDK on AIX uses strange locations for the executables
        JAVACMD="$JAVA_HOME/jre/sh/java"
    else
        JAVACMD="$JAVA_HOME/bin/java"
    fi
    if [ ! -x "$JAVACMD" ] ; then
        die "ERROR: JAVA_HOME is set to an invalid directory: $JAVA_HOME

Please set the JAVA_HOME variable in your environment to match the
location of your Java installation."
    fi
else
    JAVACMD="java"
    which java >/dev/null 2>&1 || die "ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH.

Please set the JAVA_HOME variable in your environment to match the
location of your Java installation."
fi

# Increase the maximum heap size for the Gradle wrapper.
if [ -z "$GRADLE_OPTS" ] ; then
    GRADLE_OPTS="-Xmx64m -Xms64m"
fi

# Escape arguments with spaces.
# (This is problematic on Cygwin, because shell scripts are launched via cmd.exe)
# (and cmd.exe has weird rules for quotes)
# This is also problematic for file names with spaces on systems that don't have GNU readlink.
# The following algorithm is fixed for names with spaces, but only on systems with GNU readlink.
# See https://issues.gradle.org/browse/GRADLE-1087
#
# It is assumed that the script is placed in a directory with no spaces in the path.
# The following code will be removed in a future version of Gradle.
if [ "$(uname)" = "Darwin" ] ; then
    GRADLE_OPTS_ESCAPED=""
    for arg in $GRADLE_OPTS; do
        GRADLE_OPTS_ESCAPED="$GRADLE_OPTS_ESCAPED '$arg'"
    done
    GRADLE_OPTS=$GRADLE_OPTS_ESCAPED
fi
ALL_OPTS="$DEFAULT_JVM_OPTS $JAVA_OPTS $GRADLE_OPTS"

# Start Gradle.
exec "$JAVACMD" $ALL_OPTS -cp "$CLASSPATH" org.gradle.wrapper.GradleWrapperMain "$@"
