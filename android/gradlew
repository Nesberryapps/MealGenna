#!/usr/bin/env sh

#
# Copyright 2015 the original author or authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,

# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

# ##########################################################################
#
#  Gradle startup script for UN*X
#
# ##########################################################################

# Attempt to set APP_HOME
# Resolve links: $0 may be a link
PRG="$0"
# Need this for relative symlinks.
while [ -h "$PRG" ] ; do
    ls=`ls -ld "$PRG"`
    link=`expr "$ls" : '.*-> \(.*\)$'`
    if expr "$link" : '/.*' > /dev/null; then
        PRG="$link"
    else
        PRG=`dirname "$PRG"`"/$link"
    fi
done
SAVED="`pwd`"
cd "`dirname \"$PRG\"`/" >/dev/null
APP_HOME="`pwd -P`"
cd "$SAVED" >/dev/null

APP_NAME="Gradle"
APP_BASE_NAME=`basename "$0"`

# Add default JVM options here. You can also use JAVA_OPTS and GRADLE_OPTS to pass any JVM options to this script.
DEFAULT_JVM_OPTS=""

# Use the maximum available, or set MAX_FD != -1 to use that value.
MAX_FD="maximum"

# For Darwin, add options to specify how the application appears in the dock
if [ "`uname`" = "Darwin" ]; then
    GRADLE_OPTS="$GRADLE_OPTS \"-Xdock:name=$APP_NAME\" \"-Xdock:icon=$APP_HOME/media/gradle.icns\""
fi

# OS specific support.  $var _must_ be set to either true or false.
cygwin=false
msys=false
darwin=false
nonstop=false
case "`uname`" in
  CYGWIN* )
    cygwin=true
    ;;
  Darwin* )
    darwin=true
    ;;
  MINGW* )
    msys=true
    ;;
  NONSTOP* )
    nonstop=true
    ;;
esac

# Attempt to find JAVA_HOME
if [ -z "$JAVA_HOME" ] ; then
    # Some systems exporting JAVA_HOME might not have been set up correctly
    if [ -d "/usr/java/default" ] ; then
        JAVA_HOME=/usr/java/default
    elif [ -d "/usr/lib/jvm/java-11-openjdk-amd64" ] ; then
        JAVA_HOME=/usr/lib/jvm/java-11-openjdk-amd64
    elif [ -d "/usr/lib/jvm/java-8-openjdk-amd64" ] ; then
        JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64
    elif [ -d "/usr/lib/jvm/java-7-openjdk-amd64" ] ; then
        JAVA_HOME=/usr/lib/jvm/java-7-openjdk-amd64
    elif [ -d "/usr/lib/jvm/java-6-openjdk-amd64" ] ; then
        JAVA_HOME=/usr/lib/jvm/java-6-openjdk-amd64
    elif [ -d "/usr/lib/jvm/java-1.8.0" ] ; then
        JAVA_HOME=/usr/lib/jvm/java-1.8.0
    elif [ -d "/Library/Java/JavaVirtualMachines/zulu-17.jdk/Contents/Home" ] ; then
        JAVA_HOME=/Library/Java/JavaVirtualMachines/zulu-17.jdk/Contents/Home
    fi
fi

if [ -z "$JAVA_HOME" ] ; then
    # Fallback to searching for java in the path
    JAVA_EXEC=`which java 2>/dev/null`
    if [ -z "$JAVA_EXEC" ] ; then
        echo "We couldn't find a working Java instance. Please set the JAVA_HOME environment variable."
        exit 1
    fi
else
    JAVA_EXEC="$JAVA_HOME/bin/java"
fi

if [ ! -x "$JAVA_EXEC" ] ; then
  echo "ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH." 1>&2
  echo "" 1>&2
  echo "Please set the JAVA_HOME variable in your environment to match the" 1>&2
  echo "location of your Java installation." 1>&2
  exit 1
fi

# Alter the app base name if this is a symlink
if [ "$APP_BASE_NAME" != "gradle" ] ; then
    # Add a warning (once) that this script is deprecated
    if [ -z "$GRADLE_SYMLINK_MESSAGE" ] ; then
        echo "The '$APP_BASE_NAME' script is deprecated and will be removed in a future version of Gradle."
        echo "Please use the 'gradle' script instead."
        export GRADLE_SYMLINK_MESSAGE='true'
    fi
fi

# Add the '-XX:MaxPermSize' argument for Java versions < 8
if [ -z "$GRADLE_OPTS" ] ; then
    # Extract the major and minor version numbers from the 'java -version' command
    # e.g. '1.8' from 'java version "1.8.0_91"'
    JAVA_VERSION=`"$JAVA_EXEC" -version 2>&1 | awk -F '"' '/version/ {print $2}' | cut -d . -f 1-2`
    if [ "$JAVA_VERSION" != "1.8" ] && [ "$JAVA_VERSION" != "1.9" ] && [ "$JAVA_VERSION" != "9" ] && [ "$JAVA_VERSION" != "10" ] && [ "$JAVA_VERSION" != "11" ] ; then
        # For Java < 8, add the '-XX:MaxPermSize' argument
        # For Java 8, this argument is ignored
        # For Java > 8, this argument is not recognized
        if `echo "$JAVA_VERSION" | grep -q "1\."[1-7]`; then
            GRADLE_OPTS='-XX:MaxPermSize=256m'
        fi
    fi
fi

# Set the GRADLE_HOME
GRADLE_HOME="$APP_HOME/gradle"

# Read the wrapper properties
WRAPPER_PROPS="$APP_HOME/gradle/wrapper/gradle-wrapper.properties"
if [ -f "$WRAPPER_PROPS" ]; then
    while IFS='=' read -r key value
    do
        case $key in
            distributionUrl)
                distributionUrl=$value
                ;;
        esac
    done < "$WRAPPER_PROPS"
fi

# Construct the JAR file name
if [ -n "$distributionUrl" ]; then
    # Extract the file name from the URL
    jarName=`basename "$distributionUrl"`
    # Construct the JAR file path
    GRADLE_WRAPPER_JAR="$APP_HOME/gradle/wrapper/$jarName"
else
    # Fallback to a default
    GRADLE_WRAPPER_JAR="$APP_HOME/gradle/wrapper/gradle-wrapper.jar"
fi

# No me!
if [ "$APP_BASE_NAME" = "gradle" ] && [ -f "$GRADLE_WRAPPER_JAR" ]; then
    # This script is the wrapper
    # The real gradle script is in the distribution
    # Let's use it
    GRADLE_MAIN_CLASS=org.gradle.wrapper.GradleWrapperMain
else
    # This is a distribution
    GRADLE_MAIN_CLASS=org\
.gradle.launcher.GradleMain
fi

# Collect all arguments for the java command, following recommended practice
if [ -n "$JAVA_OPTS" ]; then
    echo "Warning: JAVA_OPTS is not a built-in JVM flag. If you are using it to pass arguments to the JVM, please use GRADLE_OPTS instead."
fi

# Add GRADLE_OPTS to the beginning of the arguments list
GRADLE_ARGS="$GRADLE_OPTS"

# For Cygwin, switch paths to Windows format before running java
if $cygwin ; then
    APP_HOME=`cygpath --path --mixed "$APP_HOME"`
    CLASSPATH=`cygpath --path --mixed "$CLASSPATH"`
    JAVACMD="$JAVA_EXEC"
    # We build the pattern for arguments to be converted to Windows paths
    PATTERN="^-D|^--|^s*$"
    for arg do
        if [[ "$arg" =~ $PATTERN ]]; then
            GRADLE_ARGS="$GRADLE_ARGS \"`cygpath --path --mixed "$arg"`\""
        else
            GRADLE_ARGS="$GRADLE_ARGS \"$arg\""
        fi
    done
else
    JAVACMD="$JAVA_EXEC"
    for arg do
        GRADLE_ARGS="$GRADLE_ARGS \"$arg\""
    done
fi

# Determine the JAR to run
if [ -f "$GRADLE_WRAPPER_JAR" ]; then
    # Use the wrapper JAR
    CLASSPATH="$GRADLE_WRAPPER_JAR"
else
    # Use the distribution JARs
    if [ -z "$GRADLE_HOME" ]; then
        echo "Error: GRADLE_HOME is not set."
        exit 1
    fi
    CLASSPATH="$GRADLE_HOME/lib/*.jar"
fi

# Split up the JVM options only if spaces are available
if [ -z "$JAVA_OPTS" ] ; then
    JAVA_OPTS=
fi
if [ -z "$DEFAULT_JVM_OPTS" ] ; then
    DEFAULT_JVM_OPTS=
fi

# Add the GRADLE_OPTS to the list of arguments
if [ -n "$GRADLE_OPTS" ] ; then
    # Add quotes around each argument
    GRADLE_OPTS=`echo "$GRADLE_OPTS" | sed -e 's/ \+/\" \"/g' -e 's/^/\"/' -e 's/$/\"/'`
    # Escape the quotes for the eval
    GRADLE_OPTS=`echo "$GRADLE_OPTS" | sed 's/\"/\\\"/g'`
fi

# Set the working directory
if [ -z "$APP_HOME" ]; then
    echo "Error: APP_HOME is not set."
ar
    exit 1
fi
cd "$APP_HOME"

# Execute Gradle
eval exec \"$JAVACMD\" $DEFAULT_JVM_OPTS $JAVA_OPTS "$GRADLE_OPTS" -classpath \"$CLASSPATH\" $GRADLE_MAIN_CLASS "$@"

