#!/usr/bin/env sh

#
# Copyright 2015 the original author or authors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#      https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

# Add default JVM options here. You can also use JAVA_OPTS and GRADLE_OPTS to pass JVM options to this script.
DEFAULT_JVM_OPTS="-Xmx2048m -Xms512m"

APP_NAME="Gradle"
APP_BASE_NAME=`basename "$0"`

# Use the maximum available path length for the descriptive process name
if uname -s | grep -i "linux" > /dev/null; then
    # For Linux, the maximum length of the command line argument is 4096
    MAX_PATH_LEN=4096
else
    # For other OSes, use a conservative value
    MAX_PATH_LEN=1024
fi

# Use that either as the process name or as a fallback description
if [ -z "$PROCNAME" ]; then
    # Check for symbolic link
    if [ -L "$0" ]; then
        # Expand the symbolic link
        LINK_TARGET=`readlink "$0"`
        if [ "${LINK_TARGET#/}" = "$LINK_TARGET" ]; then
            # Relative link
            PROCPATH="`dirname "$0"`/$LINK_TARGET"
        else
            # Absolute link
            PROCPATH="$LINK_TARGET"
        fi
        # Make the path absolute
        PROCPATH="`cd \`dirname "$PROCPATH"\`; pwd -P`/`basename "$PROCPATH"`"
    else
        PROCPATH="$0"
    fi
    # Make the path absolute
    PROCPATH="`cd \`dirname "$PROCPATH"\`; pwd -P`/`basename "$PROCPATH"`"
    # Truncate the path to the maximum allowed length
    PROCNAME=${PROCPATH#${PROCPATH%????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????}}
    if [ "$PROCNAME" != "$PROCPATH" ]; then
        PROCNAME="...${PROCNAME}"
    fi
    PROCDESC="$PROCPATH"
else
    PROCDESC="$PROCNAME"
fi
export PROCNAME
export PROCDESC

# For Cygwin, ensure paths are in UNIX format before anything is touched
if $cygwin ; then
    [ -n "$JAVA_HOME" ] && JAVA_HOME=`cygpath --unix "$JAVA_HOME"`
    [ -n "$GRADLE_HOME" ] && GRADLE_HOME=`cygpath --unix "$GRADLE_HOME"`
fi

# Attempt to set APP_HOME
# Resolve links: $0 may be a link
PRG="$0"
# Need this for relative symlinks.
while [ -h "$PRG" ] ; do
    ls=`ls -ld "$PRG"`
    link=`expr "$ls" : '.*-> \(.*\)$'`
    if expr "$link" : '/.*' > /dev/null; then
        PRG="$link"
    else
        PRG=`dirname "$PRG"`"/$link"
    fi
done
SAVED="`pwd`"
cd "`dirname \"$PRG\"`/" >/dev/null
APP_HOME="`pwd -P`"
cd "$SAVED" >/dev/null

# Attempt to set APP_HOME for standalone build.
if [ -z "$APP_HOME_TOKEN" ] ; then
    APP_HOME_TOKEN=gradle
fi
if [ -z "$APP_HOME" -o ! -d "$APP_HOME"/$APP_HOME_TOKEN ] ; then
    # a more robust search for APP_HOME, checking each component of the path
    # for the existence of the APP_HOME_TOKEN folder
    # see: https://github.com/gradle/gradle/issues/10330
    TEST_PATH="$APP_HOME"
    while [ -n "$TEST_PATH" ] ; do
        if [ -d "$TEST_PATH"/$APP_HOME_TOKEN ] ; then
            APP_HOME="$TEST_PATH"
            break
        fi
        # remove the last path component
        TEST_PATH="${TEST_PATH%/*}"
    done
fi
if [ -z "$APP_HOME" ] ; then
    echo "Can't find APP_HOME, exiting"
    exit 1
fi

# Add default gradle props here. You can also use GRADLE_OPTS to pass any gradle properties to this script.
#DEFAULT_GRADLE_PROPS="-Dorg.gradle.jvmargs=\"-Xmx64m -Xms64m\""

CLASSPATH="$APP_HOME"/gradle/wrapper/gradle-wrapper.jar


# Determine the Java command to use to start the JVM.
if [ -n "$JAVA_HOME" ] ; then
    if [ -x "$JAVA_HOME/jre/sh/java" ] ; then
        # IBM's JDK on AIX uses strange locations for the executables
        JAVACMD="$JAVA_HOME/jre/sh/java"
    else
        JAVACMD="$JAVA_HOME/bin/java"
    fi
    if [ ! -x "$JAVACMD" ] ; then
        die "ERROR: JAVA_HOME is set to an invalid directory: $JAVA_HOME

Please set the JAVA_HOME variable in your environment to match the
location of your Java installation."
    fi
else
    JAVACMD="java"
    which java >/dev/null 2>&1 || die "ERROR: JAVA_HOME is not set and no 'java' command could be found in your PATH.

Please set the JAVA_HOME variable in your environment to match the
location of your Java installation."
fi

# Increase the maximum file descriptors if we can.
if [ "$cygwin" = "false" -a "$darwin" = "false" ] ; then
    MAX_FD_LIMIT=`ulimit -H -n`
    if [ $? -eq 0 ] ; then
        if [ "$MAX_FD" = "maximum" -o "$MAX_FD" = "max" ] ; then
            MAX_FD="$MAX_FD_LIMIT"
        fi
        ulimit -n $MAX_FD
        if [ $? -ne 0 ] ; then
            warn "Could not set maximum file descriptor limit: $MAX_FD"
        fi
    else
        warn "Could not query maximum file descriptor limit: $MAX_FD_LIMIT"
    fi
fi

# For Darwin, add options to specify how the application appears in the dock
if $darwin; then
    GRADLE_OPTS="$GRADLE_OPTS \"-Xdock:name=$APP_NAME\" \"-Xdock:icon=$APP_HOME/media/gradle.icns\""
fi

# For Cygwin, switch paths to Windows format before running java
if $cygwin ; then
    APP_HOME=`cygpath --path --windows "$APP_HOME"`
    CLASSPATH=`cygpath --path --windows "$CLASSPATH"`
fi

# Split up the JVM options only if this is not running on Cygwin
if [ "$cygwin" = "true" ] ; then
    split_jvm_opts=""
else
    split_jvm_opts=true
fi

# Split up the Gradle options only if this is not running on Cygwin
if [ "$cygwin" = "true" ] ; then
    split_gradle_opts=""
else
    split_gradle_opts=true
fi

# Execute Gradle
if [ "$split_jvm_opts" ] ; then
    eval exec \"\$JAVACMD\" \$DEFAULT_JVM_OPTS \$JAVA_OPTS \$GRADLE_OPTS \"-Dorg.gradle.appname=$APP_BASE_NAME\" -classpath \"\$CLASSPATH\" org.gradle.wrapper.GradleWrapperMain \"\$@\"
else
    exec "$JAVACMD" $DEFAULT_JVM_OPTS $JAVA_OPTS $GRADLE_OPTS "-Dorg.gradle.appname=$APP_BASE_NAME" -classpath "$CLASSPATH" org.gradle.wrapper.GradleWrapperMain "$@"
fi
