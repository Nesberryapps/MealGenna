{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the MealGenius application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "User's full name."
        },
        "dietaryPreferences": {
          "type": "array",
          "description": "An array of dietary preferences.",
          "items": {
            "type": "string"
          }
        },
        "allergies": {
          "type": "array",
          "description": "An array of food allergies.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "email",
        "name"
      ]
    },
    "Ingredient": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Ingredient",
      "type": "object",
      "description": "Represents an ingredient.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Ingredient entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the ingredient."
        },
        "description": {
          "type": "string",
          "description": "Description of the ingredient."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Recipe": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Recipe",
      "type": "object",
      "description": "Represents a meal recipe.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Recipe entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the recipe."
        },
        "instructions": {
          "type": "string",
          "description": "Instructions for preparing the recipe."
        },
        "preparationTime": {
          "type": "number",
          "description": "Preparation time in minutes."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the recipe image.",
          "format": "uri"
        },
        "ingredientIds": {
          "type": "array",
          "description": "References to Ingredients. (Relationship: Recipe 1:N Ingredient)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name",
        "instructions",
        "preparationTime"
      ]
    },
    "MealPlan": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MealPlan",
      "type": "object",
      "description": "Represents a 7-day meal plan for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the MealPlan entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N MealPlan)"
        },
        "startDate": {
          "type": "string",
          "description": "Start date of the meal plan.",
          "format": "date-time"
        },
        "meals": {
          "type": "array",
          "description": "Array of meal objects, each representing a meal for a specific day.",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "userId",
        "startDate",
        "meals"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Path-based ownership ensures only the user can access their data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/ingredients/{ingredientId}",
        "definition": {
          "entityName": "Ingredient",
          "schema": {
            "$ref": "#/backend/entities/Ingredient"
          },
          "description": "Stores ingredient information. Allows listing all ingredients.",
          "params": [
            {
              "name": "ingredientId",
              "description": "The unique identifier for the ingredient."
            }
          ]
        }
      },
      {
        "path": "/recipes/{recipeId}",
        "definition": {
          "entityName": "Recipe",
          "schema": {
            "$ref": "#/backend/entities/Recipe"
          },
          "description": "Stores recipe information. Allows listing all recipes.",
          "params": [
            {
              "name": "recipeId",
              "description": "The unique identifier for the recipe."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/mealPlans/{mealPlanId}",
        "definition": {
          "entityName": "MealPlan",
          "schema": {
            "$ref": "#/backend/entities/MealPlan"
          },
          "description": "Stores meal plans for each user. Path-based ownership ensures only the user can access their meal plans.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "mealPlanId",
              "description": "The unique identifier for the meal plan."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure Authorization Independence, support QAPs, and maintain data clarity. User data is stored under `/users/{userId}` following Path-Based ownership. Recipes and Ingredients are stored in top-level collections (`/recipes` and `/ingredients`) to allow listing and easy access without complex security rules. MealPlans are stored under `/users/{userId}/mealPlans` to ensure only the user has access to their meal plans. This structure avoids hierarchical authorization dependencies by not relying on `get()` calls in security rules. Each top-level collection possesses homogenous security posture to promote clarity and ease debugging.\n\nSpecifically, Authorization Independence is achieved because user data, recipes, and ingredients do not rely on parent document data for authorization. Path-based ownership (`/users/{userId}`) is employed, eliminating the necessity for complex `get()` calls in security rules.\n\nQAPs (Rules are not Filters) are supported because all documents in each top-level collection share the same security requirements. The `/recipes` and `/ingredients` collections can be securely listed without needing to filter based on user-specific criteria within the rules themselves."
  }
}